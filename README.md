# address-matching
企業名と住所を含むような日本語の文章と、全部の(企業名、住所)のリストが与えられた時に、マッチングを行う

## 目的

あらかじめ与えられた企業名とその住所のリストに基づいて、文章に含まれる企業名を抽出する。

ファイル中の区切り文字は全てタブ。

### 入力

* (ユニークID、日付、日本語の文章)の組からなるリスト
  * 元々想定されているのは日経プレスリリースの本文

```
NIKPRLRSP038060_07012003        20030107        発表日：２００３年１月７日中国で単音・和音　着信メロディ配信サービスヤマハ『美麗鈴（メロリン）』を開始　ヤマハ株式会社（本社：静岡県浜松市中沢町１０－１、社長：伊藤修二）は、中国最大手の携帯電話事業者である、中国移動通信（Ｃｈｉｎａ　Ｍｏｂｉｌｅ　Ｃｏｍｍｕｎｉｃａｔｉｏｎｓ　Ｃｏｒｐｏｒａｔｉｏｎ　〈略称：ＣＭＣＣ〉　本社：　北京市　社長：Ｚｈａｎｇ　Ｌｉｇｕｉ）の地域会社である広東移動通信有限責任公司（Ｇｕａｎｇｄｏｎｇ　Ｍｏｂｉｌｅ　Ｃｏｍｍｕｎｉｃａｔｉｏｎｓ　Ｃｏｒｐｏｒａｔｉｏｎ　〈略称：ＧＭＣＣ）に対し、広東省地域で単音・和音（４和音・１６和音・４０和音）着信メロディ配信サービス、ヤマハ『美麗鈴（メロリン）』を、２００３年１月１日から提供開始しました。　中国ではここ数年で携帯電話の普及が急速に進んでいます。人口約１３億人に対し、現在利用者数は世界第一位の約２億人にのぼり、大きな市場性があると考えられます。今回サービスを開始する広東省は、人口約９０００万人に対し、携帯電話加入者数は約２７００万人と中国国内では最も普及率の高い地域です。加えて商業が盛んで、携帯電話端末によるデータ通信も非常に多いことから、今後の着信メロディ市場のさらなる成長が期待されています。また、当社は既に香港での着信メロディサービスを開始していますが、広東省は地理的にも香港に隣接し、文化の影響を多く受けていることから、これまで培った経験・ノウハウを活用できると考えています。　なお、今回のサービス展開にあたっては、香港での着信メロディ配信事業立ち上げ時から協力関係にあった、ｉｉＬ社（ｉｉＬ　Ｃｏｒｐ　Ｌｔｄ．　本社：香港　社長：Ｋｉｎ　Ｋｏ）を現地でのパートナーとして、中華曲を中心とした現地ヒット曲の選曲、中国語化などの配信運営を行います。『美麗鈴（メロリン）』は、ｉｉＬ社が運営する着信メロディやゲームを提供する携帯電話サイト『夢飛行（中国名）』（英語名：Ｍｏｆｆｙ）から提供されます。　当社は、アジア地域では既に台湾・香港で着信メロディ配信サービスを行っていますが、今回のサービス開始を機に、中国市場でも積極的な展開をしていく方針です。＜サービス概要＞　名称：ヤマハ『美麗鈴（メロリン）　夢飛行』　サービス内容：携帯電話着信メロディ配信サービス　サービス開始：２００３年１月１日（和音端末向け）　　　　　　　　　　　単音端末向けについては２００３年３月予定　利用料金：従量制　単音　１曲＝１元　　　　　　　　和音　１曲＝２元　対応機種：ノキア製端末／ＮＥＣ製端末／パナソニック製端末／　　　　　　　　サムソン製端末／モトローラ製端末／その他中国メーカー製端末　初年度売上目標：３０００万円広東移動通信有限責任公司　会社概要　正式名称：広東移動通信有限責任公司　　　　　　　　Ｇｕａｎｇｄｏｎｇ　Ｍｏｂｉｌｅ　Ｃｏｍｍｕｎｉｃａｔｉｏｎｓ　Ｃｏｒｐｏｒａｔｉｏｎ　設立：１９９８年１月　社長：Ｌｉ　Ｇａｎｇ　契約者数：２１９３万人ｉｉＬ社　会社概要　正式名称：ｉＮＦＯｉＳＬＩＶＥ　Ｃｏｒｐｏｒａｔｉｏｎ　Ｌｔｄ　設立：１９９８年８月　社長：Ｋｉｎ　Ｋｏ　所在地：本社　香港　　　　　　　支社　広州市　北京市　台北市文中の商品名、社名等は各社の商標または登録商標です。
```

* (企業名、住所、ユニークID)の組からなるリスト
  * 元々想定されているユニークIDは企業の証券コード

```
アーキテクツ・スタジオ・ジャパン        東京都港区高輪3-23-14   6085
アーク  大阪府大阪市中央区南本町2-2-9   7873
アークコア      東京都足立区椿2-2-2     3384
```

### 出力

* (文章のユニークID、日付、文章中の企業名を含む40文字、企業のユニークID、企業名、企業リスト中のその企業の住所をスペース区切りでパースしたもの、文章から抽出された住所のパース、住所マッチングのスコア)

```
NIKPRLRSP038060_07012003        20030107        着信メロディ配信サービスヤマハ『美麗鈴(メロリン)』を開始ヤマハ株式会社(本社:    7951    ヤマハ  静岡県 None 浜松市 中区 中沢町 None None 10 1 None None 静岡県 None 浜松市 中区 中沢町 None None 10 1 None None 9
```

## 処理の概要

1. 文章から(日本の)住所を抽出
2. 住所を都道府県・市区町村などにパース
3. 住所の前方40文字も抽出
4. 企業名・住所リストからも同様に住所のパースを行っておく
5. パースされた住所と企業名を用いて比較することで、プレスリリース-vs-企業のマッチングを求める

## 細かいこと

* プレスリリース本文、企業名などはあらかじめ半角変換してある(しなくても実行に問題は無い)
* 住所抽出の際、住所でないものが付いてくることがあるが、それらはその後のgeocodingにおいて都道府県、市区町村、丁目・番地とは扱われないので排除できる
* 企業名は完全に含まれているものをマッチとして、企業名でマッチしたものについて住所を比較した
* 住所比較は以下のスコアリングを採用した
  * 11個中9個目の住所区分まで比較
  * 先頭(都道府県)から順に比較していき、どちらかがNoneである場合は飛ばす
  * 両方Noneでないのに違う場合はその時点でスコア0とする
  * 両方Noneでなく、かつ一致した最高の区分の値をスコアとする(大きいほど良い; 最大9)

## 依存関係

* `Geography::AddressExtract::Japan`モジュール(Perl)

```
$ git clone https://github.com/yappo/p5-Geography-AddressExtract-Japan
$ cd Geography-AddressExtract-Japan; cd trunk
(Makefile.PL`中の`Test::More`を`'Test::More'`に変更)
$ perl Makefile.PL; sudo make install
```

## 使い方

```
$ python3 parse.py --script_extract /path/to/extract_address.pl listed_company_list pressrelease_list
$ python3 matching.py listed_company_list.parsed pressrelease_list.parsed > matching.result
```

## TODO

* 最初に住所で弾いているものの、文章中で同じ位置から複数の企業名がマッチする場合が稀にある(ソースネクスト等; 文章中に東京都港区までしか記載されていないとネクスやネクストと区別がつかない)ので、同じ位置に複数の企業がヒットした場合は、他の企業名に完全に包含されるものは除くようにする。